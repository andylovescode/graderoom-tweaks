<div id="notificationPanel" class="blur">
    <h3><i class="fa fa-bell"></i> Notifications</h3>
    <div id="notifications">
        <div class="divider">Important</div>
        <hr>
        <div id="important-notifications">
        </div>
        <div class="divider">Unread</div>
        <hr>
        <div id="unread-notifications">
        </div>
        <div class="divider">Dismissed</div>
        <hr>
        <div id="dismissed-notifications">
        </div>
    </div>
</div>

<script>
    let notifications = {important: [], unread: [], dismissed: []};

    async function setupNotificationPanel() {
        await showChangelog(createChangelogNotifications);
        notifications.important.forEach(n => document.getElementById("important-notifications").appendChild(n.notification));
        notifications.unread.forEach(n => document.getElementById("unread-notifications").appendChild(n.notification));
        notifications.dismissed.forEach(n => document.getElementById("dismissed-notifications").appendChild(n.notification));
    }

    function createChangelogNotifications(_versionNames) {
        for (let i = _versionNames.length - 1; i > 0; i--) {
            let version = _versionNames[i];
            if (version.startsWith("Stable")) {
                createUnread(version, "Stable", version, `<span style="cursor: pointer" onclick="onScreenVersion = '` + version + `'; showChangelog()"><b><i class="fa fa-external-link-square"></i> Open Changelog</b></span>`);
            } else if (version.startsWith("Beta")) {
                createUnread(version, "Beta", version, `<span style="cursor: pointer" onclick="onScreenVersion = '` + version + `'; showChangelog()"><b><i class="fa fa-external-link-square"></i> Open Changelog</b></span>`);
            } else if (version.startsWith("Announcement")) {
                createUnread(version, "Announcement", version, `<span style="cursor: pointer" onclick="onScreenVersion = '` + version + `'; showChangelog()"><b><i class="fa fa-external-link-square"></i> Open Changelog</b></span>`);
            }
        }
    }

    function createImportant(id, type, title, message, date) {
        notifications.important.unshift({
                                         id: id,
                                         timestamp: date,
                                         notification: createNotification(type, title, message, true, false, true, true),
                                         read: false
                                     });
    }

    function createUnread(id, type, title, message, date) {
        notifications.unread.unshift({
                                      id: id,
                                      timestamp: date,
                                      notification: createNotification(type, title, message, true, false, true, false),
                                      read: false
                                  });
        let numNotifications = notifications.unread.length + notifications.important.length;
        document.getElementById("notificationPanel").setAttribute("count", `${numNotifications}`);
        if (numNotifications > 99) {
            document.getElementById("notificationPanel").classList.add("overflowed");
        } else {
            document.getElementById("notificationPanel").classList.remove("overflowed");
        }
        document.getElementById("notificationPanel").classList.remove("announcement");
        document.getElementById("notificationPanel").classList.remove("stable");
        document.getElementById("notificationPanel").classList.remove("beta");
        document.getElementById("notificationPanel").classList.remove("sync");
        document.getElementById("notificationPanel").classList.remove("empty-sync");
        document.getElementById("notificationPanel").classList.remove("error");
        document.getElementById("notificationPanel").classList.add(type.toLowerCase());
    }

    function createNotification(type, title, message, dismissible = true, dismissed = false, pinnable = false, pinned = false) {
        let _type = type.toLowerCase();
        let notification = document.createElement("div");
        notification.classList.add("notification-card", _type);

        let header = document.createElement("span");
        header.classList.add("notification-header");

        let badge = document.createElement("span");
        badge.classList.add("notification-badge");

        let _title = document.createElement("span");
        _title.classList.add("notification-title");
        _title.innerText = title;

        header.appendChild(badge);
        header.appendChild(_title);

        let body = document.createElement("div");
        body.classList.add("notification-body");

        let _message = document.createElement("span");
        _message.classList.add("notification-message");
        _message.innerHTML = message;

        body.appendChild(_message);

        if (dismissible) {
            let closeBtn = document.createElement("span");
            if (dismissed) {
                closeBtn.classList.add("notification-undismiss");
                closeBtn.setAttribute("title", "Un-Dismiss");
            } else {
                closeBtn.classList.add("notification-dismiss");
                closeBtn.setAttribute("title", "Dismiss");
            }
            body.appendChild(closeBtn);
        }

        if (pinnable) {
            let pinBtn = document.createElement("span");
            pinBtn.classList.add("notification-pin");
            pinBtn.setAttribute("title", "Move to Important");
            if (pinned) {
                pinBtn.classList.add("pinned");
                pinBtn.setAttribute("title", "Move to Unread");
            }
            body.appendChild(pinBtn);
        }

        notification.appendChild(header);
        notification.appendChild(body);

        return notification;
    }

    function read() {

    }

    function pin() {

    }

    function unpin() {

    }

</script>
